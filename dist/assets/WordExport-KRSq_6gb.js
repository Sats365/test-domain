import{BorderStyle as P,LevelFormat as D,HeadingLevel as E,convertMillimetersToTwip as L,AlignmentType as W,Paragraph as u,TextRun as l,ImageRun as V,TableCell as j,TableRow as k,WidthType as Pt,Table as G,Bookmark as It,InternalHyperlink as Tt,ExternalHyperlink as q,Document as Et,PageBreak as _t}from"./index-oSb9kl-T.js";import{p as vt,aR as x,aS as N,aT as A,aU as Dt,aV as Wt,aW as kt}from"./index-QipI4cI9.js";const m={normal:24,heading:{1:49,2:38,3:32,4:27},code:20},p={normal:"Roboto Light",heading:"Roboto",bold:"Roboto",code:"Roboto Mono"};var y=(e=>(e.normal="normal",e[e.headingOne=1]="headingOne",e[e.headingTwo=2]="headingTwo",e[e.headingThree=3]="headingThree",e[e.headingFour=4]="headingFour",e.table="table",e.list="list",e.fence="fence",e))(y||{}),ct=(e=>(e.fence="323E4F",e))(ct||{}),T=(e=>(e.table="table",e.fence="fence",e))(T||{});const lt={table:{top:250,bottom:110,left:170,right:170},fence:{bottom:300,top:300}},ut={table:{top:{style:P.SINGLE,color:"#a4a4a4",size:10},bottom:{style:P.SINGLE,color:"#a4a4a4",size:10},left:{style:P.SINGLE,color:"#a4a4a4",size:10},right:{style:P.SINGLE,color:"#a4a4a4",size:10}},fence:{}},b={normal:{line:360.4,before:0,after:160},1:{line:360.4,before:460,after:60},2:{line:360.4,before:380,after:80},3:{line:360.4,before:300,after:80},4:{line:360.4,before:240,after:80},table:{line:360.4,before:0,after:0},list:{line:420.5,before:0,after:0},fence:{line:276,before:0,after:0}},K={note:"11mm",refObject:"6mm"},z={codeBlocks:"lightGray"},Ft={0:D.DECIMAL,1:D.LOWER_LETTER,2:D.LOWER_ROMAN},Bt={0:"·",1:"○",2:"§"},At={0:"Symbol",1:"Times New Roman",2:"Wingdings"},zt=e=>({format:Ft[e%3],text:`%${e+1}`}),$t=e=>({text:Bt[e%3],font:At[e%3]}),Mt={1:E.HEADING_1,2:E.HEADING_2,3:E.HEADING_3,4:E.HEADING_4},Ut=7,Ht={styles:{default:{heading1:{run:{font:p.heading,size:m.heading[1],bold:!0},paragraph:{spacing:b[y.headingOne]}},heading2:{run:{font:p.heading,size:m.heading[2]},paragraph:{spacing:b[y.headingTwo]}},heading3:{run:{font:p.heading,size:m.heading[3]},paragraph:{spacing:b[y.headingThree]}},heading4:{run:{font:p.heading,size:m.heading[4]},paragraph:{spacing:b[y.headingFour]}}},paragraphStyles:[{id:"fence",name:"Fence",basedOn:"Fence",next:"normal",run:{font:p.code,size:m.code,color:ct.fence},paragraph:{spacing:b[y.fence],indent:{left:L(Ut)}}}]},numbering:{config:[{reference:"orderedList",levels:Array.from({length:9}).map((e,t)=>({level:t,...zt(t),alignment:W.START,style:{run:{font:p.heading,size:m.normal},paragraph:{indent:{left:L(7.5+10*t),hanging:L(6.3)}}}}))},{reference:"bulletList",levels:Array.from({length:9}).map((e,t)=>{const{text:n,font:r}=$t(t);return{level:t,format:D.BULLET,text:n,alignment:W.START,style:{run:{font:r,size:m.normal},paragraph:{indent:{left:L(5+5*t),hanging:L(5)}}}}})}]}};function ht(e,t){return typeof t=="string"?new u({children:e,style:t}):new u({children:e,spacing:t})}function gt(e,t){t>4&&t<1&&(t=1);const n=Mt[t],r=new l({text:e});return ht([r],n)}function dt(){return new u({children:[X({size:8})]})}function ft(e,t){const n=t?.bold?p.bold:p.normal;return new l({text:e,font:n,...t,size:t?.size??m.normal})}function Ot(e){const t=mt(y.normal);return ht(e,t)}function mt(e){return b[e]?b[e]:b[y.normal]}const X=e=>ft(" ",e);class Vt{constructor(t,n,r,a,i){this._inlineConfig=t,this._blockConfig=n,this._resourceManager=r,this._fileProvider=a,this._parserContext=i}async renderInline(t,n){return(await Promise.all(t.children.map(async a=>{if(a){if(typeof a=="string"){let i=n?.removeWhiteSpace?a.trim():a;return n?.isCode&&(i=` ${i} `),ft(i,n)}return await this._inlineConfig[a.name]?.({state:this,tag:a,addOptions:n,resourceManager:this._resourceManager,fileProvider:this._fileProvider})}}))).flat().filter(a=>a)}async renderBlockAsInline(t){return(await Promise.all(t.children.map(async(n,r)=>{if(n)return typeof n=="string"?new l(n):[(await this.renderInline(n)).flat().filter(a=>a),...t.children.length>1&&t.children.length>r+1?[new l({break:1})]:[]]}))).filter(n=>n).flat(2)}async renderBlock(t,n){if(!this._blockConfig[t.name]&&this._inlineConfig[t.name])return[Ot(await this.renderInline({children:[t]}))];const r=mt(n?.paragraphType??y.normal),a=t;return n={...n,spacing:r},await this._blockConfig[t.name]?.({state:this,tag:a,addOptions:n,resourceManager:this._resourceManager,fileProvider:this._fileProvider,parserContext:this._parserContext})}}function jt(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),a=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(a),t&&(r.href=t),a.href=e,a.href}const Gt=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function S(e){const t=[];for(let n=0,r=e.length;n<r;n++)t.push(e[n]);return t}function F(e,t){const r=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return r?parseFloat(r.replace("px","")):0}function qt(e){const t=F(e,"border-left-width"),n=F(e,"border-right-width");return e.clientWidth+t+n}function Kt(e){const t=F(e,"border-top-width"),n=F(e,"border-bottom-width");return e.clientHeight+t+n}function wt(e,t={}){const n=t.width||qt(e),r=t.height||Kt(e);return{width:n,height:r}}function Xt(){let e,t;try{t=vt}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const f=16384;function Jt(e){(e.width>f||e.height>f)&&(e.width>f&&e.height>f?e.width>e.height?(e.height*=f/e.width,e.width=f):(e.width*=f/e.height,e.height=f):e.width>f?(e.height*=f/e.width,e.width=f):(e.width*=f/e.height,e.height=f))}function Qt(e,t={}){return e.toBlob?new Promise(n=>{e.toBlob(n,t.type?t.type:"image/png",t.quality?t.quality:1)}):new Promise(n=>{const r=window.atob(e.toDataURL(t.type?t.type:void 0,t.quality?t.quality:void 0).split(",")[1]),a=r.length,i=new Uint8Array(a);for(let s=0;s<a;s+=1)i[s]=r.charCodeAt(s);n(new Blob([i],{type:t.type?t.type:"image/png"}))})}function B(e){return new Promise((t,n)=>{const r=new Image;r.decode=()=>t(r),r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=e})}async function Nt(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function Yt(e,t,n){const r="http://www.w3.org/2000/svg",a=document.createElementNS(r,"svg"),i=document.createElementNS(r,"foreignObject");return a.setAttribute("width",`${t}`),a.setAttribute("height",`${n}`),a.setAttribute("viewBox",`0 0 ${t} ${n}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),a.appendChild(i),i.appendChild(e),Nt(a)}const d=(e,t)=>{if(e instanceof t)return!0;const n=Object.getPrototypeOf(e);return n===null?!1:n.constructor.name===t.name||d(n,t)};function Zt(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function te(e){return S(e).map(t=>{const n=e.getPropertyValue(t),r=e.getPropertyPriority(t);return`${t}: ${n}${r?" !important":""};`}).join(" ")}function ee(e,t,n){const r=`.${e}:${t}`,a=n.cssText?Zt(n):te(n);return document.createTextNode(`${r}{${a}}`)}function Y(e,t,n){const r=window.getComputedStyle(e,n),a=r.getPropertyValue("content");if(a===""||a==="none")return;const i=Gt();try{t.className=`${t.className} ${i}`}catch{return}const s=document.createElement("style");s.appendChild(ee(i,n,r)),t.appendChild(s)}function ne(e,t){Y(e,t,":before"),Y(e,t,":after")}const Z="application/font-woff",tt="image/jpeg",re={woff:Z,woff2:Z,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:tt,jpeg:tt,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function ae(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function J(e){const t=ae(e).toLowerCase();return re[t]||""}function ie(e){return e.split(/,/)[1]}function O(e){return e.search(/^(data:)/)!==-1}function yt(e,t){return`data:${t};base64,${e}`}async function bt(e,t,n){const r=await fetch(e,t);if(r.status===404)throw new Error(`Resource "${r.url}" not found`);const a=await r.blob();return new Promise((i,s)=>{const o=new FileReader;o.onerror=s,o.onloadend=()=>{try{i(n({res:r,result:o.result}))}catch(c){s(c)}},o.readAsDataURL(a)})}const H={};function se(e,t,n){let r=e.replace(/\?.*/,"");return n&&(r=e),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),t?`[${t}]${r}`:r}async function Q(e,t,n){const r=se(e,t,n.includeQueryParams);if(H[r]!=null)return H[r];n.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let a;try{const i=await bt(e,n.fetchRequestInit,({res:s,result:o})=>(t||(t=s.headers.get("Content-Type")||""),ie(o)));a=yt(i,t)}catch(i){a=n.imagePlaceholder||"";let s=`Failed to fetch resource: ${e}`;i&&(s=typeof i=="string"?i:i.message),s&&console.warn(s)}return H[r]=a,a}async function oe(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):B(t)}async function ce(e,t){if(e.currentSrc){const i=document.createElement("canvas"),s=i.getContext("2d");i.width=e.clientWidth,i.height=e.clientHeight,s?.drawImage(e,0,0,i.width,i.height);const o=i.toDataURL();return B(o)}const n=e.poster,r=J(n),a=await Q(n,r,t);return B(a)}async function le(e){var t;try{if(!((t=e?.contentDocument)===null||t===void 0)&&t.body)return await $(e.contentDocument.body,{},!0)}catch{}return e.cloneNode(!1)}async function ue(e,t){return d(e,HTMLCanvasElement)?oe(e):d(e,HTMLVideoElement)?ce(e,t):d(e,HTMLIFrameElement)?le(e):e.cloneNode(!1)}const he=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";async function ge(e,t,n){var r,a;let i=[];return he(e)&&e.assignedNodes?i=S(e.assignedNodes()):d(e,HTMLIFrameElement)&&(!((r=e.contentDocument)===null||r===void 0)&&r.body)?i=S(e.contentDocument.body.childNodes):i=S(((a=e.shadowRoot)!==null&&a!==void 0?a:e).childNodes),i.length===0||d(e,HTMLVideoElement)||await i.reduce((s,o)=>s.then(()=>$(o,n)).then(c=>{c&&t.appendChild(c)}),Promise.resolve()),t}function de(e,t){const n=t.style;if(!n)return;const r=window.getComputedStyle(e);r.cssText?(n.cssText=r.cssText,n.transformOrigin=r.transformOrigin):S(r).forEach(a=>{let i=r.getPropertyValue(a);a==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),d(e,HTMLIFrameElement)&&a==="display"&&i==="inline"&&(i="block"),a==="d"&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),n.setProperty(a,i,r.getPropertyPriority(a))})}function fe(e,t){d(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),d(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function me(e,t){if(d(e,HTMLSelectElement)){const n=t,r=Array.from(n.children).find(a=>e.value===a.getAttribute("value"));r&&r.setAttribute("selected","")}}function we(e,t){return d(t,Element)&&(de(e,t),ne(e,t),fe(e,t),me(e,t)),t}async function ye(e,t){const n=e.querySelectorAll?e.querySelectorAll("use"):[];if(n.length===0)return e;const r={};for(let i=0;i<n.length;i++){const o=n[i].getAttribute("xlink:href");if(o){const c=e.querySelector(o),h=document.querySelector(o);!c&&h&&!r[o]&&(r[o]=await $(h,t,!0))}}const a=Object.values(r);if(a.length){const i="http://www.w3.org/1999/xhtml",s=document.createElementNS(i,"svg");s.setAttribute("xmlns",i),s.style.position="absolute",s.style.width="0",s.style.height="0",s.style.overflow="hidden",s.style.display="none";const o=document.createElementNS(i,"defs");s.appendChild(o);for(let c=0;c<a.length;c++)o.appendChild(a[c]);e.appendChild(s)}return e}async function $(e,t,n){return!n&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(r=>ue(r,t)).then(r=>ge(e,r,t)).then(r=>we(e,r)).then(r=>ye(r,t))}const pt=/url\((['"]?)([^'"]+?)\1\)/g,be=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,pe=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Se(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Ce(e){const t=[];return e.replace(pt,(n,r,a)=>(t.push(a),n)),t.filter(n=>!O(n))}async function Re(e,t,n,r,a){try{const i=n?jt(t,n):t,s=J(t);let o;if(a){const c=await a(i);o=yt(c,s)}else o=await Q(i,s,r);return e.replace(Se(t),`$1${o}$3`)}catch{}return e}function Le(e,{preferredFontFormat:t}){return t?e.replace(pe,n=>{for(;;){const[r,,a]=be.exec(n)||[];if(!a)return"";if(a===t)return`src: ${r};`}}):e}function St(e){return e.search(pt)!==-1}async function Ct(e,t,n){if(!St(e))return e;const r=Le(e,n);return Ce(r).reduce((i,s)=>i.then(o=>Re(o,s,t,n)),Promise.resolve(r))}async function _(e,t,n){var r;const a=(r=t.style)===null||r===void 0?void 0:r.getPropertyValue(e);if(a){const i=await Ct(a,null,n);return t.style.setProperty(e,i,t.style.getPropertyPriority(e)),!0}return!1}async function xe(e,t){await _("background",e,t)||await _("background-image",e,t),await _("mask",e,t)||await _("mask-image",e,t)}async function Pe(e,t){const n=d(e,HTMLImageElement);if(!(n&&!O(e.src))&&!(d(e,SVGImageElement)&&!O(e.href.baseVal)))return;const r=n?e.src:e.href.baseVal,a=await Q(r,J(r),t);await new Promise((i,s)=>{e.onload=i,e.onerror=s;const o=e;o.decode&&(o.decode=i),o.loading==="lazy"&&(o.loading="eager"),n?(e.srcset="",e.src=a):e.href.baseVal=a})}async function Ie(e,t){const r=S(e.childNodes).map(a=>Rt(a,t));await Promise.all(r).then(()=>e)}async function Rt(e,t){d(e,Element)&&(await xe(e,t),await Pe(e,t),await Ie(e,t))}function Te(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(a=>{n[a]=r[a]}),e}const et={};async function nt(e){let t=et[e];if(t!=null)return t;const r=await(await fetch(e)).text();return t={url:e,cssText:r},et[e]=t,t}async function rt(e,t){let n=e.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,i=(n.match(/url\([^)]+\)/g)||[]).map(async s=>{let o=s.replace(r,"$1");return o.startsWith("https://")||(o=new URL(o,e.url).href),bt(o,t.fetchRequestInit,({result:c})=>(n=n.replace(s,`url(${c})`),[s,c]))});return Promise.all(i).then(()=>n)}function at(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=a.exec(r);if(c===null)break;t.push(c[0])}r=r.replace(a,"");const i=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,s="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",o=new RegExp(s,"gi");for(;;){let c=i.exec(r);if(c===null){if(c=o.exec(r),c===null)break;i.lastIndex=o.lastIndex}else o.lastIndex=i.lastIndex;t.push(c[0])}return t}async function Ee(e,t){const n=[],r=[];return e.forEach(a=>{if("cssRules"in a)try{S(a.cssRules||[]).forEach((i,s)=>{if(i.type===CSSRule.IMPORT_RULE){let o=s+1;const c=i.href,h=nt(c).then(w=>rt(w,t)).then(w=>at(w).forEach(R=>{try{a.insertRule(R,R.startsWith("@import")?o+=1:a.cssRules.length)}catch(U){console.error("Error inserting rule from remote css",{rule:R,error:U})}})).catch(w=>{console.error("Error loading remote css",w.toString())});r.push(h)}})}catch(i){const s=e.find(o=>o.href==null)||document.styleSheets[0];a.href!=null&&r.push(nt(a.href).then(o=>rt(o,t)).then(o=>at(o).forEach(c=>{s.insertRule(c,a.cssRules.length)})).catch(o=>{console.error("Error loading remote stylesheet",o)})),console.error("Error inlining remote css file",i)}}),Promise.all(r).then(()=>(e.forEach(a=>{if("cssRules"in a)try{S(a.cssRules||[]).forEach(i=>{n.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${a.href}`,i)}}),n))}function _e(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>St(t.style.getPropertyValue("src")))}async function ve(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const n=S(e.ownerDocument.styleSheets),r=await Ee(n,t);return _e(r)}async function De(e,t){const n=await ve(e,t);return(await Promise.all(n.map(a=>{const i=a.parentStyleSheet?a.parentStyleSheet.href:null;return Ct(a.cssText,i,t)}))).join(`
`)}async function We(e,t){const n=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await De(e,t);if(n){const r=document.createElement("style"),a=document.createTextNode(n);r.appendChild(a),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r)}}async function ke(e,t={}){const{width:n,height:r}=wt(e,t),a=await $(e,t,!0);return await We(a,t),await Rt(a,t),Te(a,t),await Yt(a,n,r)}async function Fe(e,t={}){const{width:n,height:r}=wt(e,t),a=await ke(e,t),i=await B(a),s=document.createElement("canvas"),o=s.getContext("2d"),c=t.pixelRatio||Xt(),h=t.canvasWidth||n,w=t.canvasHeight||r;return s.width=h*c,s.height=w*c,t.skipAutoScale||Jt(s),s.style.width=`${h}`,s.style.height=`${w}`,t.backgroundColor&&(o.fillStyle=t.backgroundColor,o.fillRect(0,0,s.width,s.height)),o.drawImage(i,0,0,s.width,s.height),s}async function Be(e,t={}){const n=await Fe(e,t);return await Qt(n)}const Ae="";class g{static async getFileByPath(t,n){return await n.getContent(t)}static async getImageSizeFromImageData(t,n=600,r=600,a=200){const i=new Image,s=URL.createObjectURL(t instanceof Blob?t:new Blob([t]));i.src=s;const o=await new Promise(c=>{i.onload=()=>{i.width>n&&c({width:n,height:n/i.width*i.height}),i.height>r&&c({height:r,width:r/i.height*i.width}),c({width:i.width,height:i.height})},i.onerror=()=>{c({width:a,height:200})}});return URL.revokeObjectURL(s),i.remove(),o}static async getImageByPath(t,n,r,a,i){if(t.extension==="svg")return g.getImageFromSvgPath(t,n,r,a,i);const s=await n.getContent(t),o=await this.getImageSizeFromImageData(s,r,a,i);return g._getImageRun(s,o)}static async getImageFromSvgPath(t,n,r,a,i){const s=(await n.getContent(t)).toString();return await g.getImageFromSvgString(s,void 0,r,a,i)}static async getImageFromSvgString(t,n,r,a,i){const s=await this.getImageFromDom(t,n),o=await this.getImageSizeFromImageData(s,r,a,i);return g._getImageRun(await s.arrayBuffer(),o)}static async getImageFromDom(t,n=!0){const r=document.createElement("div");r.innerHTML=t.trim(),r.className="imageRenderer",n&&(r.style.width="fit-content",r.style.height="fit-content"),document.body.append(r);const a=await Be(r,{fontEmbedCSS:Ae});return r.remove(),a}static _getImageRun(t,n){return new V({data:t,transformation:{height:n.height,width:n.width}})}}class C{static async renderSimpleDiagram(t,n,r,a){if(t.attributes.src&&t.attributes.content)return;const i=t.attributes.content??(await r.getContent(new x(t.attributes.src))).toString();try{const s=await new N(a).getDiagram(n,i),o=await g.getImageFromDom(s),c=await g.getImageSizeFromImageData(o);return[C.getParagraphWithImage(await o.arrayBuffer(),c)]}catch{return}}static async renderC4Diagram(t,n,r,a){if(t.attributes.src&&t.attributes.content)return;const i=t.attributes.content??(await r.getContent(new x(t.attributes.src))).toString();try{const s=await new N(a).getDiagram(n,i,NaN),o=JSON.parse(s),c=[];for(let h=0;h<o.viz.length;h++){const w=o.viz[h],R=await g.getImageFromDom(w.svg),U=await g.getImageSizeFromImageData(R);c.push(C.getParagraphWithImage(await R.arrayBuffer(),U))}return c}catch{return}}static getParagraphWithImage(t,n){return new u({children:[new V({data:t,transformation:{height:n.height,width:n.width}})],alignment:W.CENTER})}}const ze=async({tag:e,resourceManager:t})=>await C.renderSimpleDiagram(e,A.mermaid,t),$e=async({state:e,tag:t,addOptions:n})=>[...t.attributes.text?[new u({children:[new l({text:t.attributes.text,bold:!0,size:m.heading[2]})],...n,indent:{left:K.note}})]:[],...(await Promise.all(t.children.map(r=>{if(!(!r||typeof r=="string"))return e.renderBlock(r)}))).flat().filter(r=>r),new u({text:""})],Me=async({tag:e,resourceManager:t,fileProvider:n,parserContext:r})=>{const a=r.getTablesManager(),i=new Dt(a,r.fp),s=n.getItemRef(t.getAbsolutePath(new x(e.attributes.src)));try{return await i.addDiagram(s,e.attributes.tags,Wt,t.rootPath).catch(()=>{throw Error("cantGetDiagram")}),[new u({children:[await g.getImageFromSvgString(i.getSvg(),!1)],alignment:W.CENTER})]}catch{return[new u({children:[]})]}},Ue=async({tag:e,resourceManager:t,parserContext:n})=>await C.renderC4Diagram(e,A["c4-diagram"],t,n.getDiagramRendererServerUrl()),He=async({tag:e,resourceManager:t})=>await C.renderSimpleDiagram(e,A["plant-uml"],t),Oe=async({tag:e,resourceManager:t,parserContext:n})=>await C.renderSimpleDiagram(e,A["ts-diagram"],t,n.getDiagramRendererServerUrl()),Ve=async({tag:e,resourceManager:t})=>[new u({children:[await g.getImageFromSvgPath(new x(e.attributes.src),t)]})],je=async({tag:e})=>{const t=e.attributes.value.split(`
`),n=t.map((c,h)=>new l({text:c,break:h<t.length-1&&h>0?1:0})),r=new u({children:n,style:"fence"}),a=new j({children:[r],borders:ut[T.fence]}),i=[new k({children:[a]})],s={size:100,type:Pt.PERCENTAGE},o=new G({rows:i,width:s,margins:lt[T.fence]});return await Promise.resolve([dt(),o,Ge(0)])},Ge=e=>{const t=[X()],n={left:L(e)};return new u({children:t,indent:n})},qe=async({tag:e})=>{const t=e.children[0];return typeof t=="string"?Promise.resolve([gt(t,e.attributes.level)]):Promise.resolve([])},it=async({tag:e,resourceManager:t})=>{const n=await Promise.all(e.attributes.images.map(a=>g.getImageByPath(new x(a),t,e.attributes.postfix==="h"?600/e.attributes.images.length:void 0))),r=e.attributes.postfix==="v"?[new l({text:"",break:1})]:[];return[new u({children:n.map(a=>[a,...r]).flat()})]},Ke=async({state:e,tag:t})=>(await Promise.all(t.children.map(async n=>await e.renderBlock(n)))).flat(),Lt=8;class M{static async renderList(t,n,r){return(await Promise.all(n.children.map(async a=>{if(!(!a||typeof a=="string"))return await M._getRenderedBlock(t,a,r)}))).flat().filter(a=>a)}static async _getRenderedBlock(t,n,r){return(await t.renderBlock(n,r)).flat()}}const Xe=async({state:e,tag:t,addOptions:n})=>{const r="bulletList",a=Math.min(t.attributes.depth??0,Lt),i={reference:r,level:a};return await M.renderList(e,t,{numbering:i,...n})},Je=async({state:e,tag:t,addOptions:n})=>{const r=t.children.filter(o=>o&&typeof o!="string"),a=xt(),i=[];let s=[];for(let o=0;o<r.length;o++){const c=r[o];if(c.name==="p"){const h=await e.renderInline(c);s.push([...h.flat().filter(w=>w),...h&&t.children.length>1&&t.children[t.children.length-1]!==t.children[o]&&(!a[t.children[o+1]?.name]||t.children[o+1]?.name==="p")?[new l({break:1})]:[]]);continue}s.length>0&&(i.push(new u({children:s.flat(),...n,spacing:b[y.list]})),s=[]),i.push(await e.renderBlock(c))}return s.length>0&&i.push(new u({children:s.flat(),...n,spacing:b[y.list]})),i.flat()};class Qe{_counter=0;generateInstanceNumberForList(){return this._counter++}}const Ne=new Qe,Ye=async({state:e,tag:t,addOptions:n})=>{const r="orderedList",a=Math.min(t.attributes.depth??0,Lt),i=Ne.generateInstanceNumberForList(),s={reference:r,level:a,instance:i};return await M.renderList(e,t,{numbering:s,...n})},Ze=async({state:e,tag:t,addOptions:n})=>[new u({children:[...t.attributes.title?[new l({text:t.attributes.title,bold:!0,size:m.heading[4]}),new l({text:"",break:1})]:[],...await e.renderBlockAsInline(t)],indent:{left:K.note},...n})],tn=async({state:e,tag:t,addOptions:n})=>[new u({children:[...t.attributes.id?[new It({id:t.attributes.id,children:[]})]:[],...await e.renderInline(t,n)],...n})],en=async({tag:e,addOptions:t})=>{const n=e.attributes.link.replace(/^#/,"");return await Promise.resolve([new u({children:[new l({text:"См. "}),new Tt({anchor:n,children:[new l({text:n,style:"Hyperlink"})]})],...t})])},nn=async(e,t,n,r)=>await n.renderRows(t,{...r,cantSplit:!0}),rn=async(e,t,n)=>await n.renderCell(t),an=async(e,t,n)=>await n.renderCell(t,!0),sn=async(e,t,n,r)=>await n.renderRows(t,{...r,tableHeader:!0}),on=async(e,t,n,r)=>await n.renderRow(t,r),v=()=>({thead:sn,tbody:nn,td:rn,tr:on,th:an});class I{constructor(t,n){this._tableConfig=t,this._wordSerializerState=n}async renderCellContent(t,n){return await this._wordSerializerState.renderBlock(t,{...t.attributes,removeWhiteSpace:!0,paragraphType:y.table,bold:n})}async renderCell(t,n=!1){return new j({children:(await Promise.all(t.children.map(async r=>{if(!(!r||typeof r=="string"))return await this.renderCellContent(r,n)}))).flat().filter(r=>r),...t.attributes.colspan?{columnSpan:t.attributes.colspan}:[],...t.attributes.rowspan?{rowSpan:t.attributes.rowspan}:[],borders:ut[T.table]})}async renderRowContent(t){return(await Promise.all(t.children.map(async n=>{if(!(!n||typeof n=="string"))return await this._tableConfig[n.name]?.(this._wordSerializerState,n,new I(v(),this._wordSerializerState))}))).filter(n=>n)}async renderRow(t,n){return new k({children:await this.renderRowContent(t),cantSplit:!1,...n})}async renderRows(t,n){return(await Promise.all(t.children.map(async r=>{if(!(!r||typeof r=="string"))return await this._tableConfig[r.name]?.(this._wordSerializerState,r,new I(v(),this._wordSerializerState),n)}))).flat().filter(r=>r)}static async renderTable(t,n){const r=v(),a=this._getParentChildrenMap(t,n,r),i=(await Promise.all(a)).flat().filter(s=>s);return new G({rows:i,margins:lt[T.table]})}static _getParentChildrenMap(t,n,r){return n.children.map(async a=>{if(!(!a||typeof a=="string"))return await r[a.name]?.(t,a,new I(v(),t),{removeWhiteSpace:!0})})}}const cn=async({state:e,tag:t})=>{const n=new u({children:[X()]});return[dt(),await I.renderTable(e,t),n]};class st{static renderDbTable(t){return[this._getParagraph({children:[...this._getTextRun(t.code,{bold:!0,size:m.heading[3],highlight:z.codeBlocks}),...t.title.default?this._getTextRun("	"+t.title.default,{bold:!0,size:m.heading[3]}):[]]}),...t.subtitle?[this._getParagraphWithTextRun(t.subtitle)]:[],new G({rows:[new k({children:[this._getTableCell([this._getParagraphWithTextRun("field")]),this._getTableCell([this._getParagraphWithTextRun("type")]),this._getTableCell([this._getParagraphWithTextRun("description")])]}),...t.fields.map(n=>new k({children:[this._getTableCell([this._getParagraphWithTextRun(n.code+(n.nullable?"":" *")+(n.primary?" PK":"")),...n.refObject?[this._getParagraphWithTextRun("→ "+n.refObject,{indent:{firstLine:K.refObject}})]:[]]),this._getTableCell([this._getParagraphWithTextRun(n.sqlType)]),this._getTableCell([this._getParagraph({children:[...n.title.default?this._getTextRun(n.title.default):[],...n.title.default&&n.description.default?this._getTextRun("",{break:1}):[],...n.description.default?this._getTextRun(n.description.default):[]]})])]}))]})]}static _getTableCell(t){return new j({children:t})}static _getParagraphWithTextRun(t,n,r){return this._getParagraph({children:this._getTextRun(t,r),...n})}static _getParagraph(t){return new u(t)}static _getTextRun(t,n){return[new l({text:t,...n})]}}const ln=async({tag:e})=>{const t=e.attributes.object;return await Promise.all([...st.renderDbTable(t),...Object.values(t.refs).filter(n=>n).map(n=>[new u(""),st.renderDbTable(n)]).flat(2)])},un=async({tag:e})=>await Promise.resolve([new u({children:[new q({children:[new l({text:e.attributes.title,style:"Hyperlink"})],link:e.attributes.path})]})]),xt=()=>({p:tn,ol:Ye,ul:Xe,li:Je,Heading:qe,Table:cn,Note:Ze,Fence:je,Cut:$e,See:en,Include:Ke,Video:un,"Img-v":it,"Img-h":it,Drawio:Ve,"Db-table":ln,"Ts-diagram":Oe,"Plant-uml":He,"Db-diagram":Me,"C4-diagram":Ue,Mermaid:ze}),hn=async()=>await Promise.resolve([new l({text:"αlfa",highlight:"red"})]),gn=async()=>await Promise.resolve([new l({text:"βeta",highlight:"yellow"})]),ot=async()=>await Promise.resolve([new l({text:"",break:1})]),dn=async({tag:e})=>await Promise.resolve([new l({text:e.attributes.text,highlight:z.codeBlocks})]),fn=async({state:e,tag:t,addOptions:n})=>{const r=p.code,a={style:P.SINGLE},i=m.code,s={...n,font:r,border:a,size:i,isCode:!0};return await e.renderInline(t,s)},mn=async({state:e,tag:t,addOptions:n})=>await e.renderInline(t,{...n,color:t.attributes.color}),wn=async({state:e,tag:t,addOptions:n})=>await e.renderInline(t,{...n}),yn=async({state:e,tag:t,addOptions:n})=>await e.renderInline(t,{...n,italics:!0}),bn=async({tag:e})=>{const t=await g.getImageFromDom(e.attributes.content),n=await g.getImageSizeFromImageData(t);return[new V({data:await t.arrayBuffer(),transformation:{height:n.height,width:n.width}})]},pn=async({tag:e,resourceManager:t})=>[await g.getImageByPath(new x(e.attributes.src),t),...e.attributes.title?[new l({text:e.attributes.title})]:[]],Sn=async({tag:e})=>await Promise.resolve([new q({children:[new l({text:e.attributes.id,style:"Hyperlink"})],link:kt(e.attributes.id)})]),Cn=async({tag:e})=>await Promise.resolve([new l({text:e.attributes.text,highlight:z.codeBlocks})]),Rn=async({state:e,tag:t,addOptions:n})=>[new q({children:await e.renderInline(t,{...n,style:"Hyperlink"}),link:t.attributes.href})],Ln=async({tag:e})=>await Promise.resolve([new l({text:e.attributes.id,highlight:z.codeBlocks})]),xn=async({state:e,tag:t,addOptions:n})=>await e.renderInline(t,{...n,bold:!0}),Pn=async({tag:e,addOptions:t})=>await Promise.resolve([new l({text:e.attributes.title,...t})]),In=async({tag:e})=>await Promise.resolve([new l({text:" / "+e.attributes.text})]),Tn=async({tag:e})=>await Promise.resolve([new l({text:" / "+e.attributes.text})]),En=()=>({strong:xn,em:yn,Link:Rn,Image:pn,Code:fn,Br:ot,br:ot,Color:mn,Alfa:hn,Beta:gn,Who:Tn,When:In,Issue:Sn,Kbd:Cn,Cmd:dn,Module:Ln,Formula:bn,Cut:wn,Term:Pn});class Dn{constructor(t,n){this._fileProvider=t,this._parserContext=n}async getDocumentFromArticle(t){return await this._getDocument([t])}async getDocumentFromArticles(t){return await this._getDocument(t,!0)}async _getDocument(t,n){const r=(await this._getDocumentSections(t,n)).filter(a=>a);return new Et({sections:r,...Ht})}_getDocumentSections(t,n){const a={page:{margin:{top:567,bottom:567,right:1049,left:1049}}};try{return Promise.all(t.map(async(i,s)=>({properties:a,children:[...await this._parseArticle(i),...n&&s+1<t.length?[new u({children:[new _t]})]:[]]})))}catch{return}}async _parseArticle(t){if(!t.content||typeof t.content=="string")return;const n=new Vt(En(),xt(),t.resourceManager,this._fileProvider,this._parserContext),r=[];for(const a of t.content.children)if(a&&typeof a!="string"){const i=await n.renderBlock(a);i&&r.push(...[].concat(i))}return[gt(t.title,1),...r]}}export{Dn as default};
